<!DOCTYPE HTML>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="index.css">
    <!-- <script src="index.js"></script> -->
    <script>
        var dragSrc = '';
        function initPieces(){
            html = '';
            for (i = 0; i < 2; i++) { 
                html += '<tr>';
                for (j = 0; j < 6; j++){
                    html += "<td id='b"+i+"-"+j+"' ondrop='drop(event)' ondragover='allowDrop(event)'><div id='p"+i+"-"+j+"' class='piece piece1' draggable='true' ondragstart='drag(event)'></div></td>"
                }
                html += '</tr>';
            }
            for (i = 2; i < 4; i++) { 
                html += '<tr>';
                for (j = 0; j < 6; j++){
                    html += "<td id='b"+i+"-"+j+"' ondrop='drop(event)' ondragover='allowDrop(event)'></td>"
                }
                html += '</tr>';
            }
            for (i = 4; i < 6; i++) { 
                html += '<tr>';
                for (j = 0; j < 6; j++){
                    html += "<td id='b"+i+"-"+j+"' ondrop='drop(event)' ondragover='allowDrop(event)'><div id='p"+i+"-"+j+"' class='piece piece2' draggable='true' ondragstart='drag(event)'></div></td>"
                }
                html += '</tr>';
            }
            document.getElementById('table').innerHTML = html;
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            console.log('move from: ', ev.path[1].id);
            dragSrc = ev.path[1].id;
            var id = ev.path[1].id;
            var x = parseInt(id[3]);
            var y = parseInt(id[1]);
            console.log(x, y);
            // detect available locations
            for (i = x-1; i < x+2; i++){
                for (j = y-1; j < y+2; j++){
                    var ele = document.getElementById('b'+j+'-'+i);
                    if (ele != null){
                        if (ele.childNodes.length <= 0){
                            document.getElementById('b'+j+'-'+i).style.border = '1px solid black';
                            console.log('b'+j+'-'+i);
                        }
                    }
                }
            }
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function drop(ev) {
            // console.log(ev);
            console.log('move to: ', ev.target.id);
            ev.preventDefault();
            // check whether don't move
            console.log(dragSrc);
            console.log(ev.target.id);
            if (dragSrc === ev.target.id){
                console.log('dont move');
            } else if (ev.target.id[0] === 'p'){
                console.log('other piece there');
            } else{
                // move to that location
                var data = ev.dataTransfer.getData("text");
                ev.target.appendChild(document.getElementById(data));
            }
            // remove reminder border
            var t = document.getElementById("table"),
                tableRows = t.getElementsByTagName("tr"),
                r = [], i, len, tds, j, jlen;

            for ( i =0, len = tableRows.length; i<len; i++) {
                tds = tableRows[i].getElementsByTagName('td');
                for( j = 0, jlen = tds.length; j < jlen; j++) {
                    tds[j].style.border = '1px solid transparent';
                }
            }
        }
    </script>
</head>
<body onload="initPieces();">
<table id='table'></table>
<div id="board">
    <svg height="500" width="500">
        <line x1="0" y1="0" x2="500" y2="0" style="stroke:rgb(255, 191, 0);stroke-width:12" />
        <line x1="0" y1="0" x2="0" y2="500" style="stroke:rgb(255, 191, 0);stroke-width:12" />
        <line x1="500" y1="0" x2="500" y2="500" style="stroke:rgb(255, 191, 0);stroke-width:12" />
        <line x1="0" y1="500" x2="500" y2="500" style="stroke:rgb(255, 191, 0);stroke-width:12" />
        <line x1="100" y1="0" x2="100" y2="500" style="stroke:rgb(0, 170, 255);stroke-width:8" />
        <line x1="400" y1="0" x2="400" y2="500" style="stroke:rgb(0, 170, 255);stroke-width:8" />
        <line x1="200" y1="0" x2="200" y2="500" style="stroke:green;stroke-width:8" />
        <line x1="300" y1="0" x2="300" y2="500" style="stroke:green;stroke-width:8" />
        <line x1="0" y1="100" x2="500" y2="100" style="stroke:rgb(0, 170, 255);stroke-width:8" />
        <line x1="0" y1="400" x2="500" y2="400" style="stroke:rgb(0, 170, 255);stroke-width:8" />
        <line x1="0" y1="200" x2="500" y2="200" style="stroke:green;stroke-width:8" />
        <line x1="0" y1="300" x2="500" y2="300" style="stroke:green;stroke-width:8" />
    </svg>
    <div id="c1-1" class="circle circle-s"></div>
    <div id="c1-2" class="circle circle-l"></div>
    <div id="c2-1" class="circle circle-s"></div>
    <div id="c2-2" class="circle circle-l"></div>
    <div id="c3-1" class="circle circle-s"></div>
    <div id="c3-2" class="circle circle-l"></div>
    <div id="c4-1" class="circle circle-s"></div>
    <div id="c4-2" class="circle circle-l"></div>
</div>
</body>
</html>